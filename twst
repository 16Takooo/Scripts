local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Window = WindUI:CreateWindow({
    Title = "16Takoo",
    Author = "16Takoo",
    Folder = "16Takoo",
    Theme = "Dark"
})

local MainTab = Window:Tab({
    Title = "Main",
    Icon = "swords"
})

local FarmTab = Window:Tab({
    Title = "Farming",
    Icon = "pickaxe"
})

local CreatureTab = Window:Tab({
    Title = "Creatures",
    Icon = "bird"
})

local MiscTab = Window:Tab({
    Title = "Misc",
    Icon = "settings"
})

local rs = game:GetService("RunService")
local plr = game:GetService("Players").LocalPlayer
local repStorage = game:GetService("ReplicatedStorage")
local mobsFolder = workspace:WaitForChild("Mobs")
local attackEvent = repStorage.Systems.Combat.PlayerAttack
local petDamageEvent = repStorage.Systems.Combat.PetDamage
local tweenService = game:GetService("TweenService")

-- **Settings Save/Load System**
local SETTINGS_FILE = "16Takoo_Settings.json"

local function loadSettings()
    local success, data = pcall(function()
        return readfile(SETTINGS_FILE)
    end)
    
    if success and data then
        local decoded = game:GetService("HttpService"):JSONDecode(data)
        return decoded or {}
    end
    return {}
end

local function saveSettings(settingsTable)
    local encoded = game:GetService("HttpService"):JSONEncode(settingsTable)
    pcall(function()
        writefile(SETTINGS_FILE, encoded)
    end)
end

local function getRemote(path)
    local obj = repStorage
    for _, name in ipairs(path) do
        obj = obj and obj:FindFirstChild(name)
        if not obj then return nil end
    end
    return obj
end

local function getPlayerPets()
    local pets = {}
    local mobs = workspace:FindFirstChild("Mobs")
    if not mobs then return pets end
    
    for _, mob in ipairs(mobs:GetChildren()) do
        if mob:IsA("Model") then
            local owner = mob:GetAttribute("Owner")
            if owner == plr or owner == plr.Name or owner == plr.UserId then
                table.insert(pets, mob)
            end
        end
    end
    return pets
end

local function getPetAttack(pet)
    if not pet then return nil end
    
    local mobData = repStorage:FindFirstChild("Mobs")
    if mobData then
        mobData = mobData:FindFirstChild(pet.Name)
    end
    if not mobData then return nil end
    
    local attacks = mobData:FindFirstChild("Attacks")
    if not attacks then return nil end
    
    for _, atk in ipairs(attacks:GetChildren()) do
        if atk:IsA("Folder") then
            local hitbox = atk:FindFirstChild("Circle") or atk:FindFirstChild("Hitbox") or atk:FindFirstChildWhichIsA("BasePart")
            if hitbox then
                return atk.Name, hitbox
            end
        end
    end
    return nil
end

local function getClosestMob()
    local char = plr.Character
    if not char then return nil end
    
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local closest = nil
    local minDist = math.huge
    
    for _, mob in ipairs(mobsFolder:GetChildren()) do
        local hp = mob:GetAttribute("HP")
        local owner = mob:GetAttribute("Owner")
        
        if (owner == nil or owner == false) and (type(hp) ~= "number" or hp > 0) then
            if mob.Name ~= "Side Room Rune Disabled" and mob.Name ~= "TargetDummy" then
                local success, pivot = pcall(function() return mob:GetPivot() end)
                if success and pivot then
                    local dist = (pivot.Position - hrp.Position).Magnitude
                    if dist < minDist then
                        closest = mob
                        minDist = dist
                    end
                end
            end
        end
    end
    
    return closest
end

local function getRarity(item)
    if not item then return nil end
    local rarity = item:GetAttribute("Rarity")
    if rarity == nil then
        local rarityVal = item:FindFirstChild("Rarity")
        if rarityVal and rarityVal.Value ~= nil then
            return rarityVal.Value
        end
    end
    return rarity
end

local function getLevel(item)
    if not item then return nil end
    local level = item:GetAttribute("Level")
    if type(level) ~= "number" then
        local levelVal = item:FindFirstChild("Level")
        if levelVal and levelVal.Value ~= nil then
            return levelVal.Value
        end
    end
    return level
end

local function isFavorite(pet)
    if not pet then return false end
    local fav = pet:GetAttribute("Favorite")
    if type(fav) ~= "boolean" then
        local favVal = pet:FindFirstChild("Favorite")
        if favVal and favVal:IsA("BoolValue") then
            return favVal.Value
        end
        return false
    end
    return fav
end

local settings = {
    autoHit = false,
    autoHitRange = 80,
    autoHitSpeed = 0.2,
    companionStrike = false,
    companionSpeed = 0.2,
    initiateDungeon = false,
    repeatRun = false,
    grindMode = false,
    moveSpeed = 200,
    heightOffset = 50,
    chosenDungeon = "AstralDungeon",
    chosenLevel = 1,
    playerCount = 1,
    sellCreatures = false,
    creatureRarities = {},
    maxCreatureLevel = 0,
    unlockCrates = false,
    crateDelay = 0.5,
    fuseCreatures = false,
    fuseDelay = 1,
    preventKick = false,
    autoReinject = false
}

-- **Load saved settings**
local savedSettings = loadSettings()
for key, value in pairs(savedSettings) do
    if settings[key] ~= nil then
        settings[key] = value
    end
end

local connections = {}
local openingCrate = false
local fuseCooldown = 0
local grindLoopActive = false

MainTab:Section({Title = "Combat System"})

MainTab:Toggle({
    Title = "Auto Hit",
    Value = settings.autoHit,
    Callback = function(v)
        settings.autoHit = v
        saveSettings(settings)
    end
})

MainTab:Slider({
    Title = "Auto Hit Range",
    Step = 1,
    Value = {
        Min = 10,
        Max = 100,
        Default = settings.autoHitRange
    },
    Callback = function(v)
        settings.autoHitRange = v
        saveSettings(settings)
    end
})

MainTab:Slider({
    Title = "Auto Hit Speed",
    Step = 0.05,
    Value = {
        Min = 0.1,
        Max = 1.5,
        Default = settings.autoHitSpeed
    },
    Callback = function(v)
        settings.autoHitSpeed = v
        saveSettings(settings)
    end
})

MainTab:Section({Title = "Companion System"})

MainTab:Toggle({
    Title = "Companion Strike",
    Value = settings.companionStrike,
    Callback = function(v)
        settings.companionStrike = v
        saveSettings(settings)
    end
})

MainTab:Slider({
    Title = "Companion Speed",
    Step = 0.05,
    Value = {
        Min = 0.1,
        Max = 1.5,
        Default = settings.companionSpeed
    },
    Callback = function(v)
        settings.companionSpeed = v
        saveSettings(settings)
    end
})

local autoHitAccum = 0
connections.autoHit = rs.Heartbeat:Connect(function(dt)
    if not settings.autoHit then return end
    
    local char = plr.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum or hum.Health <= 0 then return end
    
    autoHitAccum = autoHitAccum + dt
    local tickWithJitter = settings.autoHitSpeed * (1 + (math.random() * 0.4 - 0.2))
    
    if autoHitAccum < math.max(0.2, tickWithJitter) then return end
    autoHitAccum = 0
    
    local pos = hrp.Position
    local targets = {}
    
    for _, mob in ipairs(mobsFolder:GetChildren()) do
        if mob:IsA("Model") and mob.Name ~= "Side Room Rune Disabled" and mob.Name ~= "TargetDummy" then
            local hp = mob:GetAttribute("HP")
            local owner = mob:GetAttribute("Owner")
            
            if (owner == nil or owner == false) and (type(hp) ~= "number" or hp > 0) then
                local success, pivot = pcall(function() return mob:GetPivot() end)
                if success and pivot then
                    local dist = (pivot.Position - pos).Magnitude
                    if dist <= settings.autoHitRange then
                        table.insert(targets, mob)
                    end
                end
            end
        end
    end
    
    if #targets > 0 then
        for i = #targets, 2, -1 do
            local j = math.random(i)
            targets[i], targets[j] = targets[j], targets[i]
        end
        
        local toAttack = {}
        for i = 1, math.min(3, #targets) do
            table.insert(toAttack, targets[i])
        end
        
        if #toAttack > 0 then
            pcall(function()
                attackEvent:FireServer(toAttack)
            end)
        end
    end
end)

local companionAccum = 0
connections.companion = rs.Heartbeat:Connect(function(dt)
    if not settings.companionStrike then return end
    
    local char = plr.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum or hum.Health <= 0 then return end
    
    companionAccum = companionAccum + dt
    local tickWithJitter = settings.companionSpeed * (1 + (math.random() * 0.4 - 0.2))
    
    if companionAccum < math.max(0.2, tickWithJitter) then return end
    companionAccum = 0
    
    local pos = hrp.Position
    local targets = {}
    
    for _, mob in ipairs(mobsFolder:GetChildren()) do
        if mob:IsA("Model") and mob.Name ~= "Side Room Rune Disabled" and mob.Name ~= "TargetDummy" then
            local hp = mob:GetAttribute("HP")
            local owner = mob:GetAttribute("Owner")
            
            if (owner == nil or owner == false) and (type(hp) ~= "number" or hp > 0) then
                local success, pivot = pcall(function() return mob:GetPivot() end)
                if success and pivot then
                    local dist = (pivot.Position - pos).Magnitude
                    if dist <= 80 then
                        table.insert(targets, mob)
                    end
                end
            end
        end
    end
    
    if #targets > 0 then
        for i = #targets, 2, -1 do
            local j = math.random(i)
            targets[i], targets[j] = targets[j], targets[i]
        end
        
        local toAttack = {}
        for i = 1, math.min(3, #targets) do
            table.insert(toAttack, targets[i])
        end
        
        if #toAttack > 0 then
            local pets = getPlayerPets()
            for _, pet in ipairs(pets) do
                if pet.Parent then
                    local attackName, hitbox = getPetAttack(pet)
                    if attackName and hitbox then
                        pcall(function()
                            petDamageEvent:FireServer(pet, attackName, hitbox, toAttack)
                        end)
                    end
                end
            end
        end
    end
end)

FarmTab:Section({Title = "Dungeon Control"})

FarmTab:Toggle({
    Title = "Auto Start",
    Value = settings.initiateDungeon,
    Callback = function(v)
        settings.initiateDungeon = v
        saveSettings(settings)
    end
})

FarmTab:Toggle({
    Title = "Play Again",
    Value = settings.repeatRun,
    Callback = function(v)
        settings.repeatRun = v
        saveSettings(settings)
    end
})

local initiateAccum = 0
connections.initiate = rs.Heartbeat:Connect(function(dt)
    if not settings.initiateDungeon then return end
    initiateAccum = initiateAccum + dt
    if initiateAccum >= 0.1 then
        initiateAccum = 0
        local remote = getRemote({"Systems", "Dungeons", "TriggerStartDungeon"})
        if remote and remote:IsA("RemoteEvent") then
            pcall(function()
                remote:FireServer()
            end)
        end
    end
end)

local repeatAccum = 0
connections.repeatRun = rs.Heartbeat:Connect(function(dt)
    if not settings.repeatRun then return end
    repeatAccum = repeatAccum + dt
    if repeatAccum >= 0.1 then
        repeatAccum = 0
        local remote = getRemote({"Systems", "Dungeons", "SetExitChoice"})
        if remote and remote:IsA("RemoteEvent") then
            pcall(function()
                remote:FireServer("GoAgain")
            end)
        end
    end
end)

FarmTab:Section({Title = "Grinding"})

FarmTab:Toggle({
    Title = "Grind Mode",
    Value = settings.grindMode,
    Callback = function(v)
        settings.grindMode = v
        saveSettings(settings)
        
        if v and not grindLoopActive then
            grindLoopActive = true
            task.spawn(function()
                while settings.grindMode and grindLoopActive do
                    local target = getClosestMob()
                    local char = plr.Character
                    if not char then 
                        task.wait(0.1)
                        continue 
                    end
                    
                    local hrp = char:FindFirstChild("HumanoidRootPart")
                    local hum = char:FindFirstChildOfClass("Humanoid")
                    
                    if target and hrp and hum and hum.Health > 0 then
                        local hp = target:GetAttribute("HP")
                        if type(hp) ~= "number" or hp > 0 then
                            local success, pivot = pcall(function() return target:GetPivot() end)
                            if success and pivot then
                                local dist = (pivot.Position - hrp.Position).Magnitude
                                if dist <= 500 then
                                    local yOffset = settings.heightOffset + math.random(-6, 6)
                                    local targetPos = pivot.Position + Vector3.new(0, yOffset, 0)
                                    local speed = math.max(50, settings.moveSpeed)
                                    local duration = math.max(0.05, dist / speed)
                                    
                                    local tween = tweenService:Create(hrp, TweenInfo.new(duration, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetPos)})
                                    
                                    local velConnection = rs.Heartbeat:Connect(function()
                                        if hrp and hrp.Parent then
                                            hrp.AssemblyLinearVelocity = Vector3.zero
                                            hrp.AssemblyAngularVelocity = Vector3.zero
                                        end
                                    end)
                                    
                                    tween:Play()
                                    tween.Completed:Wait()
                                    
                                    if velConnection then
                                        velConnection:Disconnect()
                                    end
                                end
                            end
                        end
                    end
                    
                    task.wait(0.1 + math.random() * 0.05)
                end
                grindLoopActive = false
            end)
        elseif not v then
            grindLoopActive = false
        end
    end
})

FarmTab:Slider({
    Title = "Move Speed",
    Step = 1,
    Value = {
        Min = 50,
        Max = 300,
        Default = settings.moveSpeed
    },
    Callback = function(v)
        settings.moveSpeed = v
        saveSettings(settings)
    end
})

FarmTab:Slider({
    Title = "Height Offset",
    Step = 1,
    Value = {
        Min = -100,
        Max = 100,
        Default = settings.heightOffset
    },
    Callback = function(v)
        settings.heightOffset = v
        saveSettings(settings)
    end
})

FarmTab:Section({Title = "Dungeon Setup"})

FarmTab:Dropdown({
    Title = "Select Dungeon",
    Values = {"AstralDungeon", "CastleDungeon", "CoveDungeon", "DesertDungeon", "ForestDungeon", "JungleDungeon", "MountainDungeon", "CaveDungeon", "MushroomDungeon"},
    Value = settings.chosenDungeon,
    Callback = function(v)
        settings.chosenDungeon = v
        saveSettings(settings)
    end
})

FarmTab:Dropdown({
    Title = "Difficulty Level",
    Values = {"Normal", "Medium", "Hard", "Insane"},
    Value = ({"Normal", "Medium", "Hard", "Insane"})[settings.chosenLevel] or "Normal",
    Callback = function(v)
        local diffMap = {Normal = 1, Medium = 2, Hard = 3, Insane = 4}
        settings.chosenLevel = diffMap[v] or 1
        saveSettings(settings)
    end
})

FarmTab:Dropdown({
    Title = "Player Count",
    Values = {"1", "2", "3", "4", "5"},
    Value = tostring(settings.playerCount),
    Callback = function(v)
        settings.playerCount = tonumber(v) or 1
        saveSettings(settings)
    end
})

FarmTab:Button({
    Title = "Enter Dungeon",
    Callback = function()
        local remote = getRemote({"Systems", "Parties", "SetSettings"})
        if remote and remote:IsA("RemoteEvent") then
            pcall(function()
                remote:FireServer(settings.chosenDungeon, settings.chosenLevel, settings.playerCount, false)
            end)
        end
    end
})

FarmTab:Button({
    Title = "Return To Lobby",
    Callback = function()
        local remote = getRemote({"Systems", "Dungeons", "ExitDungeon"})
        if remote and remote:IsA("RemoteEvent") then
            pcall(function()
                remote:FireServer()
            end)
        end
    end
})

CreatureTab:Section({Title = "Creature Management"})

CreatureTab:Toggle({
    Title = "Sell Creatures",
    Value = settings.sellCreatures,
    Callback = function(v)
        settings.sellCreatures = v
        saveSettings(settings)
    end
})

CreatureTab:Dropdown({
    Title = "Creature Rarities",
    Values = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic"},
    Value = settings.creatureRarities,
    Multi = true,
    AllowNone = true,
    Callback = function(v)
        settings.creatureRarities = v
        saveSettings(settings)
    end
})

CreatureTab:Slider({
    Title = "Max Creature Level",
    Step = 1,
    Value = {
        Min = 0,
        Max = 200,
        Default = settings.maxCreatureLevel
    },
    Callback = function(v)
        settings.maxCreatureLevel = v
        saveSettings(settings)
    end
})

local sellAccum = 0
connections.sell = rs.Heartbeat:Connect(function(dt)
    if not settings.sellCreatures then return end
    sellAccum = sellAccum + dt
    if sellAccum >= 0.1 then
        sellAccum = 0
        
        local playerGui = plr:FindFirstChild("PlayerGui")
        if not playerGui then return end
        local profile = playerGui:FindFirstChild("Profile")
        if not profile then return end
        local petsFolder = profile:FindFirstChild("Pets")
        if not petsFolder then return end
        
        local maxLevel = settings.maxCreatureLevel
        local toSell = {}
        
        local rarityMap = {Common = 1, Uncommon = 2, Rare = 3, Epic = 4, Legendary = 5, Mythic = 6}
        local sellRarities = {}
        for _, rarityName in ipairs(settings.creatureRarities) do
            sellRarities[rarityMap[rarityName]] = true
        end
        
        for _, pet in ipairs(petsFolder:GetChildren()) do
            if pet:IsA("IntValue") and not isFavorite(pet) then
                local rarity = getRarity(pet)
                if rarity and sellRarities[rarity] then
                    local level = getLevel(pet) or 0
                    if maxLevel == 0 or level <= maxLevel then
                        table.insert(toSell, pet)
                    end
                end
            end
        end
        
        if #toSell > 0 then
            local remote = getRemote({"Systems", "ItemSelling", "SellItem"})
            if remote and remote:IsA("RemoteEvent") then
                pcall(function()
                    remote:FireServer(toSell, {})
                end)
            end
        end
    end
end)

CreatureTab:Section({Title = "Crate System"})

CreatureTab:Toggle({
    Title = "Unlock Crates",
    Value = settings.unlockCrates,
    Callback = function(v)
        settings.unlockCrates = v
        saveSettings(settings)
    end
})

CreatureTab:Slider({
    Title = "Crate Delay",
    Step = 0.1,
    Value = {
        Min = 0.2,
        Max = 15,
        Default = settings.crateDelay
    },
    Callback = function(v)
        settings.crateDelay = v
        saveSettings(settings)
    end
})

local crateAccum = 0
connections.crates = rs.Heartbeat:Connect(function(dt)
    if not settings.unlockCrates or openingCrate then return end
    
    local interval = math.clamp(settings.crateDelay, 0.2, 15)
    crateAccum = crateAccum + dt
    
    if crateAccum < interval then return end
    crateAccum = 0
    
    local playerGui = plr:FindFirstChild("PlayerGui")
    if not playerGui then return end
    local profile = playerGui:FindFirstChild("Profile")
    if not profile then return end
    local inventory = profile:FindFirstChild("Inventory")
    if not inventory then return end
    
    local remote = getRemote({"Systems", "Pets", "OpenPetChest"})
    if not (remote and remote:IsA("RemoteEvent")) then return end
    
    for _, item in ipairs(inventory:GetChildren()) do
        local count = item:FindFirstChild("Count")
        if count and count.Value > 0 then
            local itemName = string.lower(item.Name or "")
            if string.find(itemName, "chest", 1, true) then
                openingCrate = true
                local amount = math.min(count.Value, 5)
                
                task.spawn(function()
                    for _ = 1, amount do
                        pcall(function()
                            remote:FireServer(item, 1)
                        end)
                        local waitTime = math.clamp(interval + (math.random() - 0.5) * 0.2 * interval, 0.2, 15)
                        task.wait(waitTime)
                    end
                    openingCrate = false
                end)
                break
            end
        end
    end
end)

CreatureTab:Section({Title = "Fusion System"})

CreatureTab:Toggle({
    Title = "Fuse Creatures",
    Value = settings.fuseCreatures,
    Callback = function(v)
        settings.fuseCreatures = v
        saveSettings(settings)
    end
})

CreatureTab:Slider({
    Title = "Merge Interval",
    Step = 0.1,
    Value = {
        Min = 0.2,
        Max = 15,
        Default = settings.fuseDelay
    },
    Callback = function(v)
        settings.fuseDelay = v
        saveSettings(settings)
    end
})

local fuseAccum = 0
connections.fuse = rs.Heartbeat:Connect(function(dt)
    if not settings.fuseCreatures then return end
    
    local interval = math.clamp(settings.fuseDelay, 0.2, 15)
    
    if fuseCooldown > 0 then
        fuseCooldown = math.max(0, fuseCooldown - dt)
        return
    end
    
    fuseAccum = fuseAccum + dt
    if fuseAccum >= interval then
        fuseAccum = 0
        
        local playerGui = plr:FindFirstChild("PlayerGui")
        if not playerGui then return end
        local profile = playerGui:FindFirstChild("Profile")
        if not profile then return end
        local petsFolder = profile:FindFirstChild("Pets")
        if not petsFolder then return end
        
        local remote = getRemote({"Systems", "Pets", "MergePets"})
        if not (remote and remote:IsA("RemoteEvent")) then return end
        
        local groups = {}
        for _, pet in ipairs(petsFolder:GetChildren()) do
            if pet:IsA("IntValue") and not isFavorite(pet) and pet.Parent == petsFolder then
                local rarity = tonumber(getRarity(pet)) or 0
                if rarity > 0 then
                    local level = getLevel(pet) or 0
                    local key = string.format("%s|%d|%s", pet.Name, rarity, tostring(level))
                    
                    if not groups[key] then
                        groups[key] = {rarity = rarity}
                    end
                    table.insert(groups[key], pet)
                end
            end
        end
        
        local mergeAmounts = {5, 4, 3, 2}
        for _, group in pairs(groups) do
            local rarity = group.rarity or 0
            local required = mergeAmounts[rarity]
            
            if required and #group >= required then
                local toMerge = {}
                for i = 1, required do
                    table.insert(toMerge, group[i])
                end
                
                fuseCooldown = interval
                pcall(function()
                    remote:FireServer(toMerge)
                end)
                return
            end
        end
    end
end)

MiscTab:Section({Title = "AFK Protection"})

MiscTab:Toggle({
    Title = "Anti AFK",
    Value = settings.preventKick,
    Callback = function(v)
        settings.preventKick = v
        saveSettings(settings)
    end
})

task.spawn(function()
    while task.wait(10) do
        if settings.preventKick then
            local vu = game:GetService("VirtualUser")
            pcall(function()
                vu:CaptureController()
                vu:ClickButton2(Vector2.new())
            end)
        end
    end
end)

MiscTab:Section({Title = "Auto Re-inject"})

MiscTab:Toggle({
    Title = "Auto Re-inject",
    Value = settings.autoReinject,
    Callback = function(v)
        settings.autoReinject = v
        saveSettings(settings)
        if v then
            local scriptCode = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/16Takooo/Scripts/refs/heads/main/twst"))()'
            local queueTeleport = (getfenv and getfenv() or _G).queue_on_teleport or (syn and syn.queue_on_teleport) or (getgenv and getgenv().queue_on_teleport)
            
            if queueTeleport then
                pcall(function()
                    queueTeleport(scriptCode)
                end)
            end
        end
    end
})

-- **Auto-start Grind Mode on Script Load**
if settings.grindMode then
    task.wait(2) -- Wait for game to load
    if not grindLoopActive then
        grindLoopActive = true
        task.spawn(function()
            while settings.grindMode and grindLoopActive do
                local target = getClosestMob()
                local char = plr.Character
                if not char then 
                    task.wait(0.1)
                    continue 
                end
                
                local hrp = char:FindFirstChild("HumanoidRootPart")
                local hum = char:FindFirstChildOfClass("Humanoid")
                
                if target and hrp and hum and hum.Health > 0 then
                    local hp = target:GetAttribute("HP")
                    if type(hp) ~= "number" or hp > 0 then
                        local success, pivot = pcall(function() return target:GetPivot() end)
                        if success and pivot then
                            local dist = (pivot.Position - hrp.Position).Magnitude
                            if dist <= 500 then
                                local yOffset = settings.heightOffset + math.random(-6, 6)
                                local targetPos = pivot.Position + Vector3.new(0, yOffset, 0)
                                local speed = math.max(50, settings.moveSpeed)
                                local duration = math.max(0.05, dist / speed)
                                
                                local tween = tweenService:Create(hrp, TweenInfo.new(duration, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetPos)})
                                
                                local velConnection = rs.Heartbeat:Connect(function()
                                    if hrp and hrp.Parent then
                                        hrp.AssemblyLinearVelocity = Vector3.zero
                                        hrp.AssemblyAngularVelocity = Vector3.zero
                                    end
                                end)
                                
                                tween:Play()
                                tween.Completed:Wait()
                                
                                if velConnection then
                                    velConnection:Disconnect()
                                end
                            end
                        end
                    end
                end
                
                task.wait(0.1 + math.random() * 0.05)
            end
            grindLoopActive = false
        end)
    end
end

-- **Auto-execute Auto Re-inject on Script Load**
if settings.autoReinject then
    task.wait(1)
    local scriptCode = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/16Takooo/Scripts/refs/heads/main/twst"))()'
    local queueTeleport = (getfenv and getfenv() or _G).queue_on_teleport or (syn and syn.queue_on_teleport) or (getgenv and getgenv().queue_on_teleport)
    
    if queueTeleport then
        pcall(function()
            queueTeleport(scriptCode)
        end)
    end
end
